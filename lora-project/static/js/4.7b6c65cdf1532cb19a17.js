webpackJsonp([4],{GhfV:function(e,t){},JZu1:function(e,t){},Rdd0:function(e,t){},UKRZ:function(e,t){},aqfB:function(e,t){},nZgd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("mvHQ"),s=a.n(n),r=a("DoGJ"),i=a("6wmS"),o=a("vLgD"),l="138",d="198",c="南京",u={components:{ElCard:i.a,ElRow:r.a},name:"AddDevice",props:{addUserName:{type:String,default:"default用户"},deviceForm:{type:Object,default:function(){return{deviceName:"设备名称",deviceEui:"000000000000000000",devAddress:"",devLongitude:"",devDimensionality:""}}}},data:function(){return{childData:"从子组件中获得的值",deviceName:"fsfsfs",deviceEui:"",devDimensionality:l,devLongitude:d,devAddress:"",responseinfo:"null",responseresult:!1,devEuiRule:{deviceName:[{required:!0,message:"请输入名称",trigger:"blur"}],deviceEui:[{required:!0,message:"请输入devEui",trigger:"blur"},{min:16,max:16,message:"长度只能是16",trigger:"blur"}]},devForm:{deviceName:"",deviceEui:""}}},mounted:function(){this.getInitmap()},methods:{addDevice:function(){var e=this;console.log("添加设备添加设备");var t=this;Object(o.a)({method:"post",url:"/user/adminAddDevice",params:{devEUI:this.devForm.deviceEui,devname:this.devForm.deviceName,latitude:this.devDimensionality,longitude:this.devLongitude,address:this.devAddress,aimUserId:this.addUserName}}).then(function(a){e.responseinfo=a.data.info,e.responseresult=a.data.code,1==e.responseresult?(e.$message({message:e.responseinfo,type:"success"}),t.$emit("flushDeviceList"),console.log("flush设备列表")):e.$message.error(e.responseinfo)})},getInitmap:function(){var e=new BMap.Map("allmap1"),t=new BMap.Point(118.903787,31.91416),a=new BMap.Geocoder;e.centerAndZoom(t,12);var n=new BMap.Marker(t);e.addOverlay(n),e.enableScrollWheelZoom(),e.enableContinuousZoom(),e.addEventListener("click",function(t){d=t.point.lng,l=t.point.lat,e.removeOverlay(n),n=new BMap.Marker(t.point),e.addOverlay(n),a.getLocation(t.point,function(e){var t=e.addressComponents;c=t.province+t.city+t.district+t.street+t.streetNumber})})},confirmvalue:function(){this.devLongitude=d,this.devDimensionality=l,this.devAddress=c}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"AddDevice"},[a("el-row",{staticClass:"registerContent",attrs:{gutter:12}},[a("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:12}},[a("el-card",{staticClass:"bgc"},[a("el-form",{ref:"addDev",attrs:{"label-position":"left",model:e.devForm,rules:e.devEuiRule}},[a("el-form-item",{attrs:{label:"设备名",prop:"deviceName"}},[a("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.devForm.deviceName,callback:function(t){e.$set(e.devForm,"deviceName",t)},expression:"devForm.deviceName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备EUI",prop:"deviceEui"}},[a("el-input",{attrs:{placeholder:"请输入设备16位的EUI"},model:{value:e.devForm.deviceEui,callback:function(t){e.$set(e.devForm,"deviceEui",t)},expression:"devForm.deviceEui"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备地址"}},[a("el-input",{attrs:{placeholder:"请输入设备地址"},model:{value:e.devAddress,callback:function(t){e.devAddress=t},expression:"devAddress"}})],1),e._v(" "),a("el-row",{staticStyle:{width:"35%"}},[a("el-form-item",{attrs:{label:"经度"}},[a("el-input",{model:{value:e.devLongitude,callback:function(t){e.devLongitude=t},expression:"devLongitude"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"维度"}},[a("el-input",{model:{value:e.devDimensionality,callback:function(t){e.devDimensionality=t},expression:"devDimensionality"}})],1)],1),e._v(" "),a("el-form-item",[a("el-button",{staticClass:"el-icon-location ",on:{click:e.confirmvalue}},[e._v("\n                  获取位置\n                ")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addDevice}},[e._v("确认添加")])],1)],1)],1)],1),e._v(" "),a("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:12}},[a("el-card",{staticClass:"bgc"},[a("div",{staticStyle:{height:"520px"},attrs:{id:"allmap1"}})])],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(u,v,!1,function(e){a("aqfB")},"data-v-9b471306",null).exports,f={name:"AddSensor",props:{devName:{type:String,default:function(){return"设备名称"}},devEui:{type:String,default:function(){return"设备名称"}}},data:function(){return{options:[{value:"01",label:"风速传感器"},{value:"02",label:"温湿度三合一传感器"},{value:"03",label:"GPS"}],value:""}},methods:{submitSensor:function(){var e=this;console.log("提交数据");var t=new URLSearchParams;t.append("devEUI",this.devEui),console.log(this.value),t.append("typeid",this.value);var a=this;o.a.post("/user/devices/addsensor ",t).then(function(t){console.log(t);var n=t.data;1==n.result?(e.$message.success(n.info),a.$emit("flushDeviceList"),console.log("flush设备列表")):e.$message.error(n.info)}).catch(function(t){e.$message.error(t)})}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{xl:24,lg:24,md:24,xs:24,sm:24}},[a("el-card",[a("el-form",{staticClass:"add-sensor-form"},[a("el-form-item",{attrs:{label:"设备EUI"}},[a("el-tag",[a("a",[e._v("  "+e._s(e.devEui))])])],1),e._v(" "),a("el-form-item",{attrs:{label:"设备名称"}},[a("el-tag",[a("a",[e._v(" "+e._s(e.devName))])])],1),e._v(" "),a("el-form-item",{attrs:{label:"传感器类型"}},[a("el-select",{attrs:{placeholder:"请选择",value:"value"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"传感器名称"}},[a("el-input")],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitSensor}},[e._v("确认添加")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var g=a("VU/8")(f,m,!1,function(e){a("thz6")},"data-v-ce6f6ae4",null).exports,h={name:"AddTrigger",props:{devName:{type:String,default:function(){return"设备名称"}},devEui:{type:String,default:function(){return"设备devEui"}}},mounted:function(){var e=this;o.a.get("/relaytype/getall").then(function(t){t.data.forEach(function(t){var a=new Object;a.value=t.relayType,a.label=t.relayName,e.options.push(a)})}).catch(function(e){console.log(e)})},data:function(){return{options:[],value:"",delayName:"",tableData:[]}},methods:{submitTrigger:function(){var e=this,t=new URLSearchParams,a=this;t.append("devEUI",this.devEui),t.append("relayType",this.value),o.a.post("/user/devices/addRelay",t).then(function(t){var n=t.data;1==n.result?(e.$message.success("添加成功"),a.$emit("flushDeviceList"),console.log("flush设备列表")):e.$message.error(n.info)}).catch(function(t){e.$message.error(t)})}}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-form",[a("el-form-item",{attrs:{label:"设备EUI"}},[a("el-tag",[a("a",[e._v("  "+e._s(e.devEui))])])],1),e._v(" "),a("el-form-item",{attrs:{label:"设备名称"}},[a("el-tag",[a("a",[e._v(" "+e._s(e.devName))])])],1),e._v(" "),a("el-form-item",{attrs:{label:"继电器类型"}},[a("el-select",{attrs:{placeholder:"请选择",value:"value"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"继电器名称"}},[a("el-input",{model:{value:e.delayName,callback:function(t){e.delayName=t},expression:"delayName"}})],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitTrigger}},[e._v("确认添加")])],1)],1)],1)],1)},staticRenderFns:[]};var _={name:"MyTree",components:{AddDevice:p,AddSensor:g,AddTrigger:a("VU/8")(h,y,!1,function(e){a("UKRZ")},"data-v-90ab1238",null).exports},created:function(){var e=this;o.a.get("/user/getTreeUserInfo").then(function(t){var a=t.data,n=a.data;1==a.code?e.data5=n:e.$message(a.info,"error")})},props:{data6:{type:Array,default:function(){return null}}},data:function(){var e=[];return{data4:JSON.parse(s()(e)),data5:JSON.parse(s()(e)),dialogTableVisible:!1,switchStatus:"",sensorDialog:!1,triggerDialog:!1,parentName:"user",addDeviceNode:"",addDev:{name:"",eui:""},nowData:{devEui:"user",userId:"user"},sensorNode:"",delayNode:"",sync:"未同步"}},methods:{flushDeviceList:function(){var e=this,t=this.addDeviceNode.data.label,a=this.addDeviceNode.data,n=this;o.a.get("/user/getTreeDeviceInfo",{params:{aimUserId:t}}).then(function(t){a.loaded=!1;var s=t.data,r=s.data;if("1"==s.code){var i=r;n.$set(a,"children",[]),a.children.push(i),a.loading=!0}else e.$message(s.info)})},append:function(e,t){if("deviceDir"==t.type){this.dialogTableVisible=!0;var a=e.parent;this.parentName=a.data.label,this.addDeviceNode=e.parent}else if("sensorDir"==t.type){this.sensorDialog=!0;var n=e.parent;this.addDev.name=n.data.label,this.addDev.eui=n.data.id,this.addDeviceNode=n.parent.parent}else if("triggerDir"==t.type){this.triggerDialog=!0;var s=e.parent;this.addDev.name=s.data.label,this.addDev.eui=s.data.id,this.addDeviceNode=s.parent.parent}},handelChange:function(e,t){var a=this;if("sensor"===t.type){var n=this.$loading({lock:!0,text:"正在改变传感器的值，请稍后......",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s=e.parent.parent.data.id,r=e.data.typeId,i="0";t.status&&(i="1");var l=new URLSearchParams;l.append("devEUI",s),l.append("typeid",r),l.append("state",i),o.a.post("/user/devices/changesensor",l).then(function(e){n.close();var s=e.data;0==s.result?(a.$message.error("修改失败，错误信息"+s.info),t.status=!t.status):a.$message.success("修改传感器状态成功")}).catch(function(e){n.close(),a.$message.error(e)})}"control"==t.type&&(this.sync="需同步")},remove:function(e,t){var a=this,n=this.$loading({lock:!0,text:"正在删除设备，请稍后......",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});"device"==t.type?this.$confirm("此项操作将删除该项目的所有数据，是否继续?","提示",{confirmButtonText:"忍痛删除！！",cancelButtonText:"算了吧~",type:"warning"}).then(function(){var s=new URLSearchParams;s.append("devEUI",t.id),o.a.post("/user/deleteDevice",s).then(function(s){var r=s.data;if(1==r.code){var i=e.parent,o=i.data.children||i.data,l=o.findIndex(function(e){return e.id===t.id});o.splice(l,1),a.$message.success("删除设备成功"),a.$notify.warning("您删除了设备"+t.label)}else a.$message.error(r.info+"，删除设备失败");n.close()}).catch(function(e){a.$message.error(e),n.close()})}).catch(function(){a.$message.error("取消操作")}):"sensor"==t.type&&this.$confirm("此项操作将删除此用户下的传感器以及传感器的所有数据，是否继续？","提示",{confirmButtonText:"忍痛删除！！",cancelButtonText:"算了吧~",type:"warning"}).then(function(){var s=e.parent.parent.data.id,r=t.typeId,i=new URLSearchParams;i.append("devEUI",s),i.append("typeid",r),o.a.post("/user/devices/deleteSensor",i).then(function(s){var r=s.data;if(1==r.code){var i=e.parent,o=i.data.children||i.data,l=o.findIndex(function(e){return e.id===t.id});o.splice(l,1),a.$message.success("删除传感器成功"),a.$notify.warning("删除传感器"+t.label)}else a.$message.error("删除设备失败，错误信息："+r.info);n.close()}).catch(function(e){console.log(e),n.close()})})},getInfoByUser:function(e){var t=this,a=this;"user"==e.type&&(e.loaded=!0,o.a.get("/user/getTreeDeviceInfo",{params:{aimUserId:e.label}}).then(function(n){e.loaded=!1;var s=n.data,r=s.data;if("1"==s.code){var i=r;e.children||a.$set(e,"children",[]),e.children.push(i),e.loading=!0}else t.$message(s.info)}))},getNodeInfo:function(e,t,a){},needButton:function(e){return e.type.indexOf("Dir")>0},needControl:function(e){return"sensor"==e.type||"control"==e.type},getTriggerState:function(e,t){var a=this,n=e.parent.parent.data.id,s=e.data.delayType,r=e.data.children,i=this.$loading({lock:!0,text:"正在同步继电器的状态，请稍后......",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});o.a.get("/user/devices/getRelaySwitch",{params:{devEUI:n,relayType:s}}).then(function(t){var n=t.data;if(1==n.code){var s=n.data;a.$message.success("获取消息成功"),a.sync="已同步";var o=[];s.forEach(function(e){var t=e.switchId;o[t]=e.state}),r.forEach(function(e){var t=e.switchId,a=o[t];e.status=1==a}),e.data.rightState=s}else a.$message.error("获取消息失败"),a.$notify.err(n.info);i.close()}).catch(function(e){i.close()})},changeControlState:function(e,t){e.forEach(function(e){var t=e.switchId;switchStatus[t]=e.state}),t.forEach(function(e){var t=e.switchId,a=switchStatus[t];e.status=1==a})},setTriggerState:function(e,t){var a=this,n=this.$loading({lock:!0,text:"正在批量改变继电器的状态，请稍后......",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r=e.parent.parent.data.id,i=(e.data.delayType,e.data.children),l=new Object;i.forEach(function(e){var t=e.switchId,a="0";e.status&&(a="1"),l[t]=a});var d=s()(l),c=new URLSearchParams;c.append("devEUI",r),c.append("jsonstr",d),o.a.post("/user/devices/changeRelayMulSwitch",c).then(function(e){var t=e.data;1==t.result?(a.$message.success("改变成功"),a.sync="已同步"):a.$message.error(t.info),console.log(t),n.close()}).catch(function(e){console.log(e),n.close()})}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tree",{attrs:{data:e.data6,"node-key":"id","expand-on-click-node":!1},on:{"node-click":e.getNodeInfo},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("el-row",{attrs:{type:"flex",gutter:32,justify:"start"}},[a("el-col",{attrs:{xl:16,lg:16,md:16,sm:16,xs:16}},[a("svg-icon",{attrs:{"icon-class":s.icon,"class-name":"card-panel-icon"}}),e._v(" "),"user"==s.type?a("el-tag",{staticClass:"user-name-tag"},[e._v("用户名 :"+e._s(n.label))]):e._e(),e._v(" "),"sensor"==s.type?a("el-tag",{staticClass:"user-name-tag",attrs:{type:"success"}},[e._v(e._s(n.label))]):e._e(),e._v(" "),"control"==s.type?a("el-tag",{staticClass:"user-name-tag",attrs:{type:"info"}},[e._v(e._s(n.label))]):e._e(),e._v(" "),"device"==s.type?a("el-tag",{staticClass:"user-name-tag",attrs:{type:"danger"}},[e._v(e._s(n.label))]):e._e(),e._v(" "),e.needButton(s)?a("el-tag",{staticClass:"user-name-tag",attrs:{color:"#0000"}},[e._v(e._s(n.label))]):e._e(),e._v(" "),"controlDevice"==s.type?a("el-tag",{staticClass:"user-name-tag",attrs:{color:"#0000"}},[e._v(e._s(n.label))]):e._e(),e._v(" "),e.needButton(s)?a("el-tag",{staticStyle:{"border-radius":"50%"},attrs:{color:"#0000"}},[e._v(e._s(s.children.length))]):e._e(),e._v(" "),"sensor"==s.type?a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(s.ctype))]):e._e(),e._v(" "),"control"==s.type?a("el-tag",{attrs:{type:"danger"}},[e._v(e._s(s.ctype))]):e._e()],1),e._v(" "),a("el-col",{attrs:{xl:3,lg:8,md:8,sm:8,xs:8}},[e.needControl(s)?a("span",[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){e.handelChange(n,s)}},model:{value:s.status,callback:function(t){e.$set(s,"status",t)},expression:"data.status"}})],1):e._e(),e._v(" "),a("span",{staticClass:"operate-button"},[e.needButton(s)?a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(){return e.append(n,s)}}},[e._v("\n          添加\n        ")]):e._e(),e._v(" "),"device"==s.type||"sensor"==s.type?a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(){return e.remove(n,s)}}},[e._v("\n          删除\n        ")]):e._e()],1),e._v(" "),"controlDevice"==s.type?a("span",[a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(){return e.getTriggerState(n,s)}}},[e._v("\n            "+e._s(e.sync)+"\n          ")]),e._v(" "),a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(){return e.setTriggerState(n,s)}}},[e._v("\n            改变状态\n          ")])],1):e._e(),e._v(" "),"user"==s.type?a("span",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!s.loading,expression:"!data.loading"}],attrs:{size:"mini",type:"primary",loading:s.loaded},on:{click:function(){return e.getInfoByUser(s)}}},[e._v("\n             管理")])],1):e._e()])],1)],1)}}])}),e._v(" "),a("el-dialog",{attrs:{title:"添加设备",visible:e.dialogTableVisible,width:"80%",center:"",top:"10vh","append-to-body":""},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("add-device",{ref:"addDevice",attrs:{"add-user-name":e.parentName},on:{flushDeviceList:e.flushDeviceList}})],1),e._v(" "),a("el-dialog",{attrs:{title:"添加传感器",visible:e.sensorDialog,width:"400px",center:"",top:"10vh","append-to-body":""},on:{"update:visible":function(t){e.sensorDialog=t}}},[a("add-sensor",{attrs:{"add-user-name":e.parentName,"dev-eui":e.addDev.eui,"dev-name":e.addDev.name},on:{flushDeviceList:e.flushDeviceList}})],1),e._v(" "),a("el-dialog",{attrs:{title:"添加继电器",visible:e.triggerDialog,width:"400px",center:"",top:"10vh","append-to-body":""},on:{"update:visible":function(t){e.triggerDialog=t}}},[a("add-trigger",{attrs:{"add-user-name":e.parentName,"dev-eui":e.addDev.eui,"dev-name":e.addDev.name},on:{flushDeviceList:e.flushDeviceList}})],1)],1)},staticRenderFns:[]};var D=a("VU/8")(_,b,!1,function(e){a("pg9e"),a("GhfV")},"data-v-6fa5c254",null).exports,x={name:"OnlyUser",components:{MyTree:D},props:{allUser:{type:Array,default:function(){return[{label:"tang"}]}}},data:function(){return{username:"",userData:[]}},methods:{handleOne:function(){var e=this;this.userData=this.allUser.filter(function(t){return t.id===e.username||t.id.indexOf(e.username)>=0})},handleSureOne:function(){var e=this;this.userData=this.allUser.filter(function(t){return t.id===e.username})}}},w={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{type:"flex",justify:"center",gutter:16}},[a("el-col",{attrs:{xl:12,lg:12,md:20,sm:20,xs:20}},[a("el-input",{model:{value:e.username,callback:function(t){e.username=t},expression:"username"}},[a("template",{slot:"prepend"},[e._v("用户名")])],2)],1),e._v(" "),a("el-col",{attrs:{xl:3,lg:3,md:4,sm:2,xs:2}},[a("el-button",{attrs:{type:"success"},on:{click:e.handleSureOne}},[e._v("确定搜索")])],1),e._v(" "),a("el-col",{attrs:{xl:3,lg:3,md:4,sm:2,xs:2}},[a("el-button",{attrs:{type:"danger"},on:{click:e.handleOne}},[e._v("包含搜索")])],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"}},[a("my-tree",{attrs:{data6:e.userData}})],1)],1)},staticRenderFns:[]};var $={name:"RoleManage",components:{OnlyUser:a("VU/8")(x,w,!1,function(e){a("JZu1")},"data-v-502436e7",null).exports,MyTree:D},data:function(){return{treeData:[],showDialog:!1}},mounted:function(){var e=this;o.a.get("/user/getTreeUserInfo").then(function(t){var a=t.data,n=a.data;1==a.code?(e.treeData=n,console.log(e.treeData)):e.$message(a.info,"error")})},methods:{showDia:function(){console.log(this.showDialog),this.showDialog=!0}}},E={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"device-manager",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{xl:16,lg:16,md:16,sm:24,xs:24}},[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("设备管理")]),e._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{size:"mini",type:"danger"},on:{click:e.showDia}},[e._v("对指定用户管理")])],1),e._v(" "),a("my-tree",{attrs:{data6:e.treeData}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"指定用户管理",visible:e.showDialog,width:"60%",center:"",top:"10vh"},on:{"update:visible":function(t){e.showDialog=t}}},[a("only-user",{attrs:{"all-user":e.treeData}})],1)],1)},staticRenderFns:[]};var k=a("VU/8")($,E,!1,function(e){a("Rdd0")},"data-v-91c45434",null);t.default=k.exports},pg9e:function(e,t){},thz6:function(e,t){}});
//# sourceMappingURL=4.7b6c65cdf1532cb19a17.js.map